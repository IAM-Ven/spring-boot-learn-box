<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>rocket mq 实现分布式事物</title>
    <meta content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no" id="viewport" name="viewport">
</head>
<!-- import Vue.js -->
<script src="https://vuejs.org/js/vue.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<!-- import stylesheet -->
<link rel="stylesheet" href="https://unpkg.com/iview/dist/styles/iview.css">
<!-- import iView -->
<script src="https://unpkg.com/iview/dist/iview.min.js"></script>
<body>
<div id="app">
    <div style="background:#f8f8f8;padding: 25px">
        <row gutter="10">
            <i-col span="12" v-for="bank in banks">
                <card>
                    <p slot="title">银行账户</p>
                    <p>
                        <icon type="md-person" size="18" color="#8043d4"></icon>
                        ：{{bank.accountName}}
                    </p>
                    <br/>
                    <p>
                        <icon type="logo-yen" size="16" color="#ff4400"></icon>
                        ：{{bank.money}}
                    </p>
                </card>
            </i-col>
            <!--            <i-col span="12">-->
            <!--                <card>-->
            <!--                    <p slot="title">李四账户</p>-->
            <!--                    <p>-->
            <!--                        <icon type="md-person" size="18" color="#8043d4"></icon>-->
            <!--                        ：{{ lisi.accountName }}-->
            <!--                    </p>-->
            <!--                    <br/>-->
            <!--                    <p>-->
            <!--                        <icon type="logo-yen" size="16" color="#ff4400"></icon>-->
            <!--                        ：{{lisi.money}}-->
            <!--                    </p>-->
            <!--                </card>-->
            <!--            </i-col>-->
        </row>
        <br/>

        <row gutter="10">
            <i-col span="8">
                <h2>张三
                    <icon type="md-arrow-forward" size="24"></icon>
                    李四 没有任何事物措施
                </h2>
                <i-form :label-width="40">

                    <form-item label="账户">
                        <i-input type="text" disabled size="large" v-model="account1.accountName" placeholder="对方账户"/>
                    </form-item>

                    <form-item label="金额">
                        <i-input type="number" size="large" v-model="account1.money" placeholder="转账金额"/>
                    </form-item>

                    <form-item style="text-align: center;">
                        <i-button type="primary" @click="transfer()">转账</i-button>
                    </form-item>
                </i-form>
            </i-col>

            <i-col span="8">
                <h2>张三
                    <icon type="md-arrow-forward" size="24"></icon>
                    李四 事物消息转账
                </h2>

                <i-form :label-width="40">

                    <form-item label="账户">
                        <i-input type="text" disabled size="large" v-model="account2.accountName" placeholder="对方账户"/>
                    </form-item>

                    <form-item label="金额">
                        <i-input type="number" size="large" v-model="account2.money" placeholder="转账金额"/>
                    </form-item>

                    <form-item style="text-align: center;">
                        <i-button type="primary" @click="txTransfer()">转账</i-button>
                    </form-item>
                </i-form>
            </i-col>

            <i-col span="8">
                <h2>张三
                    <icon type="md-arrow-forward" size="24"></icon>
                    李四 消息转账
                </h2>

                <i-form :label-width="40">

                    <form-item label="账户">
                        <i-input type="text" disabled size="large" v-model="account3.accountName" placeholder="对方账户"/>
                    </form-item>

                    <form-item label="金额">
                        <i-input type="number" size="large" v-model="account3.money" placeholder="转账金额"/>
                    </form-item>

                    <form-item style="text-align: center;">
                        <i-button type="primary" @click="msgTransfer()">转账</i-button>
                    </form-item>
                </i-form>
            </i-col>
        </row>
    </div>

</div>
</body>
<script>
  new Vue({
    el: '#app',
    data: {
      banks: [],
      account1: {
        accountName: 'lisi',
        money: 10
      },
      account2: {
        accountName: 'lisi',
        money: 10
      },
      account3: {
        accountName: 'lisi',
        money: 10
      }
    },
    mounted: function() {
      this.initBank();
    },
    methods: {
      // 转账
      transfer() {
        let that = this;
        axios.post("/bank/transfer", that.account1)
             .then(function( res ) {
               that.$Message.success('转账成功！');
             })
             .catch(function( ex ) {
               console.log(ex);
               that.$Message.error('转账失败！');
             });
        that.initBank();
      },
      //事物转账
      txTransfer() {
        let that = this;
        axios.post("/bank/transfer/tx", that.account2)
             .then(function( res ) {
               that.$Message.success('转账成功！');
               that.initBank();
             })
             .catch(function( error ) {
               that.$Message.error('转账失败！');
             });
      },
      //消息转账
      msgTransfer() {
        let that = this;
        axios.post("/bank/transfer/msg", that.account3)
             .then(function( res ) {
               that.$Message.success('转账成功！');
               that.initBank();
             })
             .catch(function( error ) {
               that.$Message.error('转账失败！');
             });
      },
      // 加载账户
      initBank() {
        let that = this;
        axios({
          method: 'get',
          url: '/bank',
        }).then(function( res ) {
          that.banks = res.data;
        }).catch(function( error ) {
          that.$Message.error('加载账户异常！');
        });
      }
    }
  });
</script>
<style>
    .ivu-form-label-right {
        padding: 20px 15px;
        background-color: #ffffff;
        border: 1px solid #dcdee2;
        border-radius: 5px;
    }
</style>
</html>